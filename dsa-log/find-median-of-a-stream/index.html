<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>404EngineerNotFound</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js></script><script src=https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js></script></head><body>\<header><nav><div class=logo><a href=/>404EngineerNotFound</a></div><ul class=main-nav><li class="nav-item has-dropdown"><a href=#>Writings <i class="fas fa-caret-down fa-xs"></i></a><ul class=dropdown-menu><li class=dropdown-item><a href=/stories/>Stories</a></li><li class=dropdown-item><a href=/thoughts/>Thoughts</a></li><li class=dropdown-item><a href=/fitness-log/>Fitness Log</a></li></ul></li><li class="nav-item has-dropdown"><a href=#>Tech Lab <i class="fas fa-caret-down fa-xs"></i></a><ul class=dropdown-menu><li class=dropdown-item><a href=/papershelf/>Papershelf</a></li><li class=dropdown-item><a href=/creations/>Creations</a></li><li class=dropdown-item><a href=/dsa-log/>DSA Log</a></li><li class=dropdown-item><a href=/tech-writings/>Technical Writings</a></li></ul></li><li class=nav-item><a href=/bookshelf/>Bookshelf</a></li><li class=nav-item><a href=/about/>About</a></li></ul><div class=search-container><input type=search id=search-input placeholder=Search...>
<i class="fa fa-search"></i></div></nav><div id=search-results-container><ul id=search-results></ul></div></header><main><div class=single-content-wrapper><aside class=article-sidebar><nav><h4>On this page</h4><nav id=TableOfContents><ul><li><a href=#the-problem-find-median-from-data-stream>The Problem: Find Median from Data Stream</a></li><li><a href=#brainstorming>Brainstorming</a><ul><li><a href=#balancing-algo>Balancing algo</a></li></ul></li></ul></nav></nav></aside><article class=dsa-single><h1></h1><div class=dsa-meta><p><strong>Difficulty:</strong> <span class=difficulty->N/A</span> |
<strong>Solved:</strong> January 1, 0001</p></div><div class=dsa-content><h2 id=the-problem-find-median-from-data-stream>The Problem: Find Median from Data Stream</h2><p>Imagine you&rsquo;re working at Twitter, and you need to calculate the real-time median age of all users currently active. Numbers are flowing in one by one (25, 30, 22, 40, 35, &mldr;). You can&rsquo;t store the whole stream, and you can&rsquo;t re-sort it every time a new number arrives.</p><p><strong>The Goal:</strong> Design a data structure with two methods:</p><ol><li>addNum(num): Adds a new number from the stream.</li><li>findMedian(): Returns the median of all numbers seen so far. This must be fast.</li></ol><p><strong>Median Refresher:</strong></p><ul><li><p>For an odd number of elements, the median is the middle one. [22, 25, 30] -> Median is 25.</p></li><li><p>For an even number of elements, the median is the average of the two middle ones. [22, 25, 30, 35] -> Median is (25 + 30) / 2 = 27.5.</p></li></ul><h2 id=brainstorming>Brainstorming</h2><p>So the concept of a median is essentially dividing a set of numbers into 2 halfs lower and upper</p><p>if we take the example [22,25,30] the median is 25 lower half is [22] and upper half is [30] similarly for [22,25,30,35] the median is 27.5 (25+30) the lower half is [22,25] and upper half is [30,35]</p><p>aha moment we essentially need the boundary values to calculate the median incase we have even number of elements and the lower boundaries max value in case of odd number of elements , but there is no way to determine the actual length as the elements are coming in a stream.</p><p>We can then use hepqs and priority queues and maintain the max value of the lower boundary and the min value of the upper boundary</p><p>All numbers seen so far, if they were sorted:
[ &mldr; lower half &mldr; | &mldr; upper half &mldr; ]
^
median is right here</p><p>lo_heap = max_heap (to get the maximum value of the lower end)
hi_heap = min_heap ( to get the minimum value of the upper end)</p><p>we also need to make sure that the lo and hi heaps are actually well balanced in sizes either both heaps are of the same size or the lo heap is allowed 1 element more than the hi heap. This works because by definition all the elements in the low heap will be smaller than all the elements in the hi heap</p><h3 id=balancing-algo>Balancing algo</h3><p>function addnum(num)</p><ol><li>First try to add the num to lo heap</li><li>now the low heap may have one extra element , hence we should move it to hi heap</li><li>now check the sizes of heaps if len hi heap > len lo heap we need to move the smallest element from hi heap back to low heap</li><li>the median at this point is max(lo heap)</li><li>if len low_heap == len hi heap the median at this point is lo heap[0] + hi heap[0] // 2</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> heapq
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nums <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>lo_heap <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>hi_heap <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_num</span>(num):
</span></span><span style=display:flex><span>	heapq<span style=color:#f92672>.</span>heappush(lo_heap, <span style=color:#f92672>-</span>num) <span style=color:#75715e># first try to add num to lo_heap</span>
</span></span><span style=display:flex><span>	max_lo_heap <span style=color:#f92672>=</span> heapq<span style=color:#f92672>.</span>pop(lo_heap) <span style=color:#75715e># get the max element from lo heap</span>
</span></span><span style=display:flex><span>	heapq<span style=color:#f92672>.</span>heappush(hi_heap, <span style=color:#f92672>-</span>max_lo_heap) <span style=color:#75715e># add it to the hi heap</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(hi_heap) <span style=color:#f92672>&gt;</span> len(lo_heap): <span style=color:#75715e># if hi heap is larger than low heap</span>
</span></span><span style=display:flex><span>		min_high_heap <span style=color:#f92672>=</span> heqqp<span style=color:#f92672>.</span>pop(hi_heap) <span style=color:#75715e># move the smallest element back to lo heap</span>
</span></span><span style=display:flex><span>		heapq<span style=color:#f92672>.</span>push(lo_heap, <span style=color:#f92672>-</span>min_high_heap) <span style=color:#75715e># here</span>
</span></span><span style=display:flex><span>		median <span style=color:#f92672>=</span> <span style=color:#f92672>-</span> heapq<span style=color:#f92672>.</span>pop(lo_heap) <span style=color:#75715e># the median is the largest element of the lo heap</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(hi_heap) <span style=color:#f92672>==</span> len(lo_heap):
</span></span><span style=display:flex><span>		median <span style=color:#f92672>=</span> (<span style=color:#f92672>-</span>heapq<span style=color:#f92672>.</span>pop(lo_heap) <span style=color:#f92672>+</span> heapq<span style=color:#f92672>.</span>pop(hi_heap))<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> median 
</span></span><span style=display:flex><span>	
</span></span></code></pre></div><p>so the thing this the above code is mixing 2 things add num and find median we need to separate those</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> heapq
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MedianFinder</span>:
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>		self<span style=color:#f92672>.</span>lo_heap <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>		self<span style=color:#f92672>.</span>hi_heap <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>addNum</span>(self,num):
</span></span><span style=display:flex><span>		heapq<span style=color:#f92672>.</span>heappush(self<span style=color:#f92672>.</span>lo_heap, <span style=color:#f92672>-</span>num) <span style=color:#75715e># first try to add num to lo_heap</span>
</span></span><span style=display:flex><span>		max_lo_heap <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>heapq<span style=color:#f92672>.</span>heappop(self<span style=color:#f92672>.</span>lo_heap) <span style=color:#75715e># get the max element from lo heap</span>
</span></span><span style=display:flex><span>		heapq<span style=color:#f92672>.</span>heappush(self<span style=color:#f92672>.</span>hi_heap, max_lo_heap) <span style=color:#75715e># add it to the hi heap</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> len(self<span style=color:#f92672>.</span>hi_heap) <span style=color:#f92672>&gt;</span> len(self<span style=color:#f92672>.</span>lo_heap): <span style=color:#75715e># if hi heap is larger than low heap</span>
</span></span><span style=display:flex><span>			min_high_heap <span style=color:#f92672>=</span> heaqp<span style=color:#f92672>.</span>heappop(self<span style=color:#f92672>.</span>hi_heap) <span style=color:#75715e># move the smallest element back to lo heap</span>
</span></span><span style=display:flex><span>			heapq<span style=color:#f92672>.</span>push(self<span style=color:#f92672>.</span>lo_heap, <span style=color:#f92672>-</span>min_high_heap) <span style=color:#75715e># here</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>findMedian</span>(self):
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> len(self<span style=color:#f92672>.</span>hi_heap) <span style=color:#f92672>==</span> len(self<span style=color:#f92672>.</span>lo_heap):
</span></span><span style=display:flex><span>			median <span style=color:#f92672>=</span> (<span style=color:#f92672>-</span>self<span style=color:#f92672>.</span>lo_heap[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> self<span style=color:#f92672>.</span>hi_heap[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> median
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> len(self<span style=color:#f92672>.</span>hi_heap) <span style=color:#f92672>&gt;</span> len(self<span style=color:#f92672>.</span>lo_heap):
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>  <span style=color:#f92672>-</span>self<span style=color:#f92672>.</span>lo_heap[<span style=color:#ae81ff>0</span>]	
</span></span><span style=display:flex><span>		
</span></span></code></pre></div></div></article></div></main><footer><p>&copy; 2025 Deepanshu Kandpal</p></footer><a id=scrollTopBtn title="Go to top"><i class="fa-solid fa-arrow-up"></i></a>
<script src=/js/search.js></script><script>var mybutton=document.getElementById("scrollTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.classList.add("show"):mybutton.classList.remove("show")}mybutton.onclick=function(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("code.language-mermaid");e.forEach(function(e,t){const n=document.createElement("div");n.className="mermaid",n.textContent=e.textContent,n.id="mermaid-"+t,e.parentNode.parentNode.replaceChild(n,e.parentNode)}),mermaid.initialize({startOnLoad:!0,theme:"default",themeVariables:{primaryColor:"#4a90e2",primaryTextColor:"#333",primaryBorderColor:"#4a90e2",lineColor:"#333"}}),mermaid.init()})</script></body></html>